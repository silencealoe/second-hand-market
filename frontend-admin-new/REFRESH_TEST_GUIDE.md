# 页面刷新问题测试指南

## 测试步骤

### 1. 正常登录测试
1. 打开浏览器，访问应用
2. 使用有效账号密码登录
3. 成功登录后应跳转到 Dashboard 页面
4. 检查浏览器开发者工具 → Application → Local Storage
5. 确认存在 `token` 和 `userInfo` 数据

### 2. 页面刷新测试
1. 在 Dashboard 页面点击浏览器刷新按钮（F5 或 Ctrl+R）
2. **预期结果**：页面刷新后仍然保持在 Dashboard 页面，不会跳转到登录页
3. 检查控制台日志，应该看到 "Token 验证成功" 的消息

### 3. Token 过期测试
1. 在浏览器开发者工具中手动修改 localStorage 中的 token 值
2. 将 token 改为无效值，如 "invalid_token"
3. 刷新页面
4. **预期结果**：页面应该自动跳转到登录页面
5. 检查控制台日志，应该看到 "Token 验证失败" 的消息

### 4. 数据损坏测试
1. 在浏览器开发者工具中手动修改 localStorage 中的 userInfo 值
2. 将 userInfo 改为无效的 JSON，如 "invalid_json"
3. 刷新页面
4. **预期结果**：页面应该自动跳转到登录页面
5. localStorage 中的损坏数据应该被自动清除

### 5. 已登录用户访问登录页测试
1. 确保用户已登录（在 Dashboard 页面）
2. 手动在地址栏输入 `/login` 访问登录页
3. **预期结果**：应该自动重定向到 Dashboard 页面

### 6. 网络异常测试
1. 在浏览器开发者工具中切换到 Network 面板
2. 设置网络为 "Offline" 模式
3. 刷新页面
4. **预期结果**：应该显示加载状态，而不是立即跳转到登录页

## 调试信息

在浏览器控制台中查看以下日志：

### 成功场景
```
Token 验证成功
```

### 失败场景
```
Token 验证失败，清除认证状态: [错误信息]
Failed to parse user info: [错误信息]
```

### API 调用日志
```
🚀 API Request: GET /admin/auth/me
✅ API Response: GET /admin/auth/me
```

## 常见问题排查

### 问题1：刷新后仍然跳转到登录页
**可能原因**：
- Token 已过期
- 后端 `/admin/auth/me` 接口返回错误
- 网络连接问题

**排查方法**：
1. 检查控制台错误日志
2. 检查 Network 面板中的 API 调用
3. 确认后端服务是否正常运行

### 问题2：页面一直显示加载状态
**可能原因**：
- `/admin/auth/me` 接口响应超时
- 网络连接异常

**排查方法**：
1. 检查网络连接
2. 检查后端服务状态
3. 查看 Network 面板中的请求状态

### 问题3：登录页面无法访问
**可能原因**：
- 已登录用户被自动重定向

**排查方法**：
1. 清除 localStorage 数据
2. 或者先退出登录再访问

## 性能注意事项

1. **Token 验证频率**：每次页面刷新都会调用一次验证接口
2. **网络开销**：增加了一次 API 调用
3. **用户体验**：验证期间会显示加载状态

## 后续优化建议

1. **Token 过期时间缓存**：在 localStorage 中存储 token 过期时间，避免频繁验证
2. **离线支持**：网络异常时使用缓存的认证状态
3. **重试机制**：验证失败时提供重试选项
4. **更好的加载 UI**：使用骨架屏替代简单的 Spin 组件